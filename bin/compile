#!/bin/sh

#  Usage:
#  -------
#    bin/compile BUILD_DIR CACHE_DIR ENV_DIR
#
#      -  `BUILD_DIR` will be the location of the app
#
#      -  `CACHE_DIR` will be the locaiton the buildpack can use to cache build
#         artifacts between builds
#
#      -  `ENV_DIR` is a directory that contains a file for each of the app's
#         configuration variables
#
#  Link(s):
#  -------
#   https://devcenter.heroku.com/articles/buildpack-api
#
#  Note(s):
#  -------
#    This script performs the buildpack transformation.
#    All output received on `stdout` will be displayed to the user.

# Parse args
BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

# Create the cache dir if it doesn't exist
mkdir -p $CACHE_DIR

# Download zip from Dropbox
echo "-----> Downloading zip..."
curl -L http://downloads.sourceforge.net/project/infozip/Zip%203.x%20%28latest%29/3.0/zip30.tar.gz\?r\=http%3A%2F%2Fsourceforge.net%2Fprojects%2Finfozip%2Ffiles%2FZip%25203.x%2520%2528latest%2529%2F3.0%2F\&ts\=1398377764\&use_mirror\=hivelocity | tar xz
#curl --location https://www.dropbox.com/s/zg3h7bbf21uw0ec/zip-binary.tar.gz | tar xz



# Move zip into ./vendor and make them executable
echo "-----> Installing zip..."
mkdir -p $BUILD_DIR/vendor
mkdir -p $BUILD_DIR/vendor/zip
#mkdir -p $BUILD_DIR/vendor/zip/bin
mv zip30 $BUILD_DIR/vendor/zip
make -f unix/Makefile generic

#chmod +x $BUILD_DIR/vendor/zip/bin/*
#PATH=$PATH:$BUILD_DIR/vendor/zip/bin

